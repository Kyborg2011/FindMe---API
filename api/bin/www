#!/usr/bin/env node

var config = require('../app/helpers/nconf.js');
var http = require('http');
var express = require('express');
var app = express();
var port = config.get('env:port');
var mongoose = require('mongoose');
mongoose.Promise = require('bluebird');
var helmet = require('helmet');
var autoIncrement = require('mongoose-auto-increment');

mongoose.connect(config.get("env:mongoose:uri"));

var connection = mongoose.createConnection(config.get("env:mongoose:uri"));
autoIncrement.initialize(connection);

var passport = require('passport');
var bodyParser = require('body-parser');
require('../app/helpers/passport')(passport);

var oauth2 = require('../app/helpers/auth');

app.use(helmet.noCache());
app.use(helmet.frameguard());

app.use(bodyParser.json());
app.use(bodyParser.urlencoded({
  extended: true
}));

app.use(passport.initialize());

require('../app/routes/routes.js')(app, passport);

http.createServer(app).listen(port);

console.log('RESTful API is started on port ' + port);
